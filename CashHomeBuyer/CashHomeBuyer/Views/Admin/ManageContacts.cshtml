@{
    ViewBag.Title = "ManageContacts";
}
<h2 id="admin_head">Manage Contacts</h2>

    <div class="col-xl-12">
        <div class="row" id="space"></div>
        <div class="row">
            <div class="container-fluid" id="contacts">
                <table class="table" id="contact_table">
                    <thead>
                        <tr>
                            <th scope="col">Address</th>
                            <th scope="col">Name</th>
                            <th scope="col">Email</th>
                            <th scope="col">Phone</th>
                            <th scope="col">Contact Date</th>
                            <th scope="col">Notes</th>
                        </tr>
                    <thead>
                </table>
            </div>
        </div>
    </div>
<script>
    $(document).ready(function () {
        loadContacts();
    });

    function loadContacts() {

        var contacttable = $('#contact_table');

        contacttable.empty();

        $.ajax({
            type: 'GET',
            url: 'http://localhost:59555/contacts/',
            success: function (data, status) {
                $.each(data, function (index, contact) {
                    var id = contact.ContactID;
                    var address = contact.ContactAddress;
                    var name = contact.ContactName;
                    var email = contact.ContactEmail;
                    var phone = contact.ContactPhone;
                    var dateadded = contact.ContactDate;
                    var notes = contact.Notes;

                    var date = dateadded.split('T')[0]

                    var d = new Date(date);

                    var month = d.getMonth() + 1
                    var day = d.getDate() + 1
                    var year = d.getFullYear()

                    row = '<tbody>'
                    row = '<tr>'
                    row += '<td>' + address + '</td>';
                    row += '<td>' + name + '</td>';
                    row += '<td>' + email + '</td>';
                    row += '<td>' + phone + '</td>';
                    row += '<td>' + month + '/' + day + '/' + year + '</td>';
                    

                    if (notes == null) {
                        row += '<td>' + ' ' + '</td>';
                    }
                    else {
                        row += '<td>' + notes + '</td>';
                    }

                    row += '<td><button onclick="Edit(' + id + ')">Edit</button></td>';
                    row += '<td><button onclick="Delete(' + id + ')">Delete</button></td>';
                    row += '</tr>'
                    row += '</tbody>'
                    row += '</table>'

                    contacttable.append(row);

                });
            },
            error: function () {
                $('#errorMessages')
                    .append($('<li>')
                        .attr({ class: 'list-group-item list-group-item-danger' })
                        .text('Error calling web service. Please try again later.'));
            }
        });
    }

    function Delete(id) {

        var c = confirm("Are you sure you want to delete this contact?")

        if (c) {
            $.ajax({
                type: 'DELETE',
                url: 'http://localhost:59555/contacts/delete/' + id,
                success: function (status) {
                    loadContacts();
                }
            })
        }
    }

    function Edit(id) {
        window.location = "/admin/editcontact/" + id;
    }

</script>